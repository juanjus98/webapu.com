function setClassRow(a){var b="active";switch(a){case"terminada":b="active";break;case"abandonada":b="danger";break;case"en-cola":b="queue_row";break;case"activa":b="info";break;default:b="active"}return b}$.setDataPost=function(){return{queue:Cookies.get("queueCurrent")}},$.setAgentes=function(a){return $.each(a,function(a,b){var c=b.agentchannel.split("/");Cookies.set("agentstatus-"+c[1],b.agentstatus);var d=b.sec_calls,e=b.total_break,f=b.total_sessions-d-e;d=d.toString().toHHMMSS(),e=e.toString().toHHMMSS(),f=f.toString().toHHMMSS(),"offline"===b.agentstatus?($("#cont_agent").append('<tr class="'+b.classrow+'" id="rowagent-'+c[1]+'"><td><center>'+c[1]+"</center></td><td><center>"+b.agentname+'</center></td><td class="agentstatus" id="agentstatus-'+c[1]+'" data-agentstatus="'+b.agentstatus+'">'+b.agentstatus_es+"</td></tr>"),$("#cont_agent_atendidas").append('<tr class="'+b.classrow+'" id="rowatendidasagente-'+c[1]+'"><td class="num_calls" id="num_calls-'+c[1]+'" data-num_calls="'+b.num_calls+'">'+b.num_calls+"</td></tr>"),$("#cont_agent_time").append('<tr class="'+b.classrow+'" id="rowtime-'+c[1]+'"><td class="total_convers" id="total_convers-'+c[1]+'" data-sec_calls="'+b.sec_calls+'">'+d+'</td><td id="total_espera-'+c[1]+'">'+f+'</td><td id="total_break-'+c[1]+'">'+e+"</td></tr>")):($("#cont_agent").prepend('<tr class="'+b.classrow+'" id="rowagent-'+c[1]+'"><td><center>'+c[1]+"</center></td><td><center>"+b.agentname+'</center></td><td class="agentstatus" id="agentstatus-'+c[1]+'" data-agentstatus="'+b.agentstatus+'">'+b.agentstatus_es+"</td></tr>"),$("#cont_agent_atendidas").prepend('<tr class="'+b.classrow+'" id="rowatendidasagente-'+c[1]+'"><td class="num_calls" id="num_calls-'+c[1]+'" data-num_calls="'+b.num_calls+'">'+b.num_calls+"</td></tr>"),$("#cont_agent_time").prepend('<tr class="'+b.classrow+'" id="rowtime-'+c[1]+'"><td class="total_convers" id="total_convers-'+c[1]+'" data-sec_calls="'+b.sec_calls+'">'+d+'</td><td id="total_espera-'+c[1]+'">'+f+'</td><td id="total_break-'+c[1]+'">'+e+"</td></tr>"))}),!0},$.setEstadosAgentes=function(a){return $.each(a,function(a,b){var c=b.agentchannel.split("/"),d=$("#agentstatus-"+c[1]).attr("data-agentstatus");b.agentstatus!==d&&($("#agentstatus-"+c[1]).attr("data-agentstatus",b.agentstatus),$("#agentstatus-"+c[1]).html(b.agentstatus_es),$("#rowagent-"+c[1]).removeClass().addClass(b.classrow),$("#rowtime-"+c[1]).removeClass().addClass(b.classrow),$("#rowatendidasagente-"+c[1]).removeClass().addClass(b.classrow)),$("#num_calls-"+c[1]).html(b.num_calls);var e=b.sec_calls,f=b.total_break,g=b.total_sessions-e-f;if(e=e.toString().toHHMMSS(),f=f.toString().toHHMMSS(),g=g.toString().toHHMMSS(),$("#total_break-"+c[1]).html(f),"online"===b.agentstatus&&$("#total_espera-"+c[1]).html(g),"oncall"===b.agentstatus){var h=$("#total_convers-"+c[1]).data("sec_calls")+1;$("#total_convers-"+c[1]).data("sec_calls",h),e=h.toString().toHHMMSS()}$("#total_convers-"+c[1]).html(e)}),!0},$.setLlamadas=function(a){var b=(Object.keys(a).length,"");return $.each(a,function(a,c){var d="--",e="--",f="--",g="--";if(null!==c.agentchannel){d=c.agentchannel.split("/")[1]}null!==c.agentname&&""!==c.agentname&&(e=c.agentname),null!==c.datetime_end&&""!==c.datetime_end&&(f=c.datetime_end),null!==c.duration&&""!==c.duration&&(g=c.duration,g=g.toString().toHHMMSS()),b=setClassRow(c.status),Cookies.set("call_entry-"+c.id,c.status),$("#cont_llamadas").prepend('<tr class="'+b+'" id="rowcall-'+c.id+'"><td><center id="call_canal-'+c.id+'">'+d+'</center></td><td><center id="call_agentname-'+c.id+'">'+e+"</center></td><td><center>"+c.callerid+"</center></td><td><center>"+c.datetime_entry_queue+'</center></td><td><center id="call_datetime_end-'+c.id+'">'+f+'</center></td><td><center id="call_duration-'+c.id+'">'+g+'</center></td><td class="callstatus" id="call_entry-'+c.id+'" data-call_entry_id="'+c.id+'" data-callstatus="'+c.status+'">'+c.status+"</td></tr>"),$("#cont_llamadas > tr").length>maxLlamadas&&$("#cont_llamadas tr:last-child").remove()}),!0},$.setNuevasLlamadas=function(a){var b=Object.keys(a).length,c="";return b>0&&$.each(a,function(a,b){var d="--",e="--",f="--",g="--";if(null!==b.agentchannel){d=b.agentchannel.split("/")[1]}null!==b.agentname&&""!==b.agentname&&(e=b.agentname),null!==b.datetime_end&&""!==b.datetime_end&&(f=b.datetime_end),null!==b.duration&&""!==b.duration&&(g=b.duration,g=g.toString().toHHMMSS()),c=setClassRow(b.status),Cookies.set("call_entry-"+b.id,b.status),$("#cont_llamadas").prepend('<tr class="'+c+'" id="rowcall-'+b.id+'"><td><center id="call_canal-'+b.id+'">'+d+'</center></td><td><center id="call_agentname-'+b.id+'">'+e+"</center></td><td><center>"+b.callerid+"</center></td><td><center>"+b.datetime_entry_queue+'</center></td><td><center id="call_datetime_end-'+b.id+'">'+f+'</center></td><td><center id="call_duration-'+b.id+'">'+g+'</center></td><td class="callstatus" id="call_entry-'+b.id+'" data-call_entry_id="'+b.id+'" data-callstatus="'+b.status+'">'+b.status+"</td></tr>"),$("#cont_llamadas > tr").length>maxLlamadas&&$("#cont_llamadas tr:last-child").remove()}),!0},$.upEstadoLLamadas=function(){var a=[];return $(".callstatus").each(function(b){var c=$(this).data("callstatus"),d=$(this).data("call_entry_id");"en-cola"!==c&&"activa"!==c||a.push(d)}),Object.keys(a).length>0&&$.ajax({method:"POST",url:base_url+"phpjson/listarLlamadas.php",dataType:"json",data:{queue:queueSelect,tipo:"RELOAD",calls:a},success:function(a){$.each(a,function(a,b){var c="",d="--",e="--",f="--",g="--";null!==b.agentchannel&&(d=b.agentchannel.split("/")[1]),null!==b.agentname&&""!==b.agentname&&(e=b.agentname),null!==b.datetime_end&&""!==b.datetime_end&&(f=b.datetime_end),null!==b.duration&&""!==b.duration&&(g=b.duration,g=g.toString().toHHMMSS());var h=$("#call_entry-"+b.id).data("callstatus");b.status!=h&&(c=setClassRow(b.status),$("#call_canal-"+b.id).html(d),$("#call_agentname-"+b.id).html(e),$("#call_datetime_end-"+b.id).html(f),$("#call_duration-"+b.id).html(g),$("#call_entry-"+b.id).data("callstatus",b.status).html(b.status),$("#rowcall-"+b.id).removeClass().addClass(c))})}}),!0},$.setLlamadasTotales=function(a){var b=a.duracion_entrantes;b=b.toString().toHHMMSS();var c=a.duracion_atendidas;c=c.toString().toHHMMSS();var d=a.duracion_abandonadas;d=d.toString().toHHMMSS(),$("#total_entrantes").html(a.total_entrantes+" <span>("+b+")</span>"),$("#total_atendidas").html(a.total_atendidas+" <span>("+c+")</span>"),$("#total_abandonadas").html(a.total_abandonadas+" <span>("+d+")</span>"),$("#total_encola").html(a.total_encola);var e=$("#cont_agent .info").length,f=$("#cont_agent .success").length,g=$("#cont_agent .warning").length;return $("#total_conversando").html(e),$("#total_disponibles").html(f),$("#total_enbreak").html(g),!0},$.getDataJson=function(a,b,c){return $.ajax({method:"POST",url:a,data:b,dataType:"json",success:c})},String.prototype.toHHMMSS=function(){var a=parseInt(this,10),b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=a-3600*b-60*c;return b<10&&(b="0"+b),c<10&&(c="0"+c),d<10&&(d="0"+d),b+":"+c+":"+d},$(function(){$('[data-toggle="tooltip"]').tooltip();var a=base_url+"phpjson/listarAgentes.php",b={queue:queueSelect};$.getDataJson(a,b,$.setAgentes),setInterval(function(){$.getDataJson(a,b,$.setEstadosAgentes)},1e3);var c=base_url+"phpjson/listarLlamadasTotales.php",d={queue:queueSelect};setInterval(function(){$.getDataJson(c,d,$.setLlamadasTotales)},1e3)});